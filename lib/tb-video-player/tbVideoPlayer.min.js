!function(){"use strict";function e(){function e(e){var t=10>e?["00",e].join(""):100>e?["0",e].join(""):e;return t}function t(e){var t=10>e?["0",e].join(""):e;return t}function i(e,i){var n=Math.floor(e/60),o=t("up"!=i?Math.floor(e%60):Math.ceil(e%60));return[n,":",o].join("")}function n(){var e,t=document.createElement("fakeelement"),i=["OTransform","MozTransform","WebkitTransform"];for(e in i)if("undefined"!=typeof t.style[i[e]])return i[e];return"transform"}function o(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}var s=this;s.pad3=e,s.pad2=t,s.parseTime=i,s.whichTransitionEvent=o,s.browserTransform=n}function t(){return{restrict:"E",replace:!0,scope:{data:"=",slides:"=",src:"=",videoEnd:"&"},controller:"TbVideoPlayerCtrl",templateUrl:"js/directives/templates/videoPlayer.html",link:function(e,t,i){function n(){"function"==typeof e.videoEnd&&e.video.addEventListener("ended",e.videoEnd,!1)}function o(){for(var t=e.slides.length-1;t--;){if(!e.slides[t].hasOwnProperty("timeIndex"))return e.STATES.hasSlides=!1,console.error('Object used in "slides" attribute is missing property: "timeIndex"'),!1;if(!e.slides[t].hasOwnProperty("slideUrl"))return e.STATES.hasSlides=!1,console.error('Object used in "slides" attribute is missing property: "slideUrl"'),!1}return!0}e.master=t[0],e.video=e.master.querySelector("video"),e.STATES={},e.STATES.hasControls="undefined"!=typeof i.controls,e.STATES.hasSlides="undefined"!=typeof e.slides&&!!e.slides.length&&o(),e.video.addEventListener("canplay",n,!1)}}}angular.module("tb-video-player",["tb-video-player.templates"]).controller("TbVideoPlayerCtrl",[e]).directive("tbVideoPlayer",[t]).filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}])}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,require:"^tbVideoPlayer",templateUrl:"js/directives/templates/videoSlides.html",link:function(e,t,i,n){function o(){console.log("resetting slidevars"),m={videoDimensions:{bounds:f.video.getBoundingClientRect()},slideDimensions:{bounds:null,offsetLeft:f.slideContainer.offsetLeft,offsetTop:f.slideContainer.offsetTop},fullSizeSlide:null,pictureChanged:!1,needsResize:!1,canBeReset:!0}}function s(e){m.needsResize=!0,T||o(),a(e)}function r(){T?(m.canBeReset=!1,null===m.fullSizeSlide&&(m.fullSizeSlide=f.slideContainer.getBoundingClientRect()),f.slideClone.style.top=m.fullSizeSlide.top-f.master.offsetTop+"px",f.slideClone.style.left=m.fullSizeSlide.left-f.master.offsetLeft+"px",f.slideClone.style.width=m.fullSizeSlide.width+"px",f.slideClone.style.height=m.fullSizeSlide.height+"px",f.master.classList.add("slide-clone-visible")):(m.pictureChanged||m.needsResize)&&(m.canBeReset=!0,o())}function d(){m.slideDimensions.bounds=f.slideContainer.getBoundingClientRect();var e=m.videoDimensions.bounds.width/m.slideDimensions.bounds.width,t=m.videoDimensions.bounds.height/m.slideDimensions.bounds.height;return Math.min(e,t)}function l(e){m.scale=d();var t=-1*(m.slideDimensions.offsetLeft-(m.videoDimensions.bounds.width-m.slideDimensions.bounds.width*m.scale)/2)+"px",i=-1*m.slideDimensions.offsetTop+"px";e.preventDefault(),f.slideContainer.style[S]="translate("+t+", "+i+") scale("+m.scale+")",T=!0}function a(e){e.preventDefault(),f.slideContainer.style[S]=null,f.master.classList.remove("slide-clone-visible"),T=!1}function u(){function t(){e.STATES.currentSlideImgSrc=i,m.pictureChanged=!0,(m.canBeReset=!1)&&c()}var i,n=Math.ceil(f.video.currentTime),s=h-1;for(m.pictureChanged===!0&&m.canBeReset===!0&&o();s--;)if(n>=e.slides[s].timeIndex&&n<e.slides[s+1].timeIndex)return i=e.slides[s].slideUrl,void(e.STATES.currentSlideImgSrc!==i&&e.$apply(t))}function c(){null===m.fullSizeSlide,r()}function v(){o(),f.slideImage=f.slideContainer.querySelector("img"),f.slideClone=f.master.querySelector(".video-slide-clone"),f.video.addEventListener("timeupdate",u,!1),f.slideContainer.addEventListener("mousedown",l,!1),f.slideContainer.addEventListener("touchstart",l,!1),f.slideClone.addEventListener("mousedown",a,!1),f.slideClone.addEventListener("touchstart",a,!1),f.slideContainer.addEventListener(p,r,!1),window.addEventListener("resize",s,!1)}var m,f={},p=n.whichTransitionEvent(),S=n.browserTransform(),T=!1,h=e.slides.length;f.slideContainer=t[0],f.master=e.master,f.video=e.video,f.video.addEventListener("canplay",v,!1)}}}angular.module("tb-video-player").directive("tbVideoSlide",[e])}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,require:"^tbVideoPlayer",templateUrl:"js/directives/templates/videoControls.html",link:function(e,t,i,n){function o(){p=h.slider.getBoundingClientRect(),S=h.node.offsetWidth}function s(t){T=h.video.duration,e.STATES.isPlaying=!h.video.paused,o(),r()}function r(){var e=h.video.currentTime,t=T-e;d(e,t)}function d(t,i){var o=t*p.width/T-S/2;h.node.style.left=[o,"px"].join(""),e.$apply(function(){e.STATES.timeIn=n.parseTime(t,"up"),e.STATES.timeLeft=n.parseTime(i,"down")})}function l(e){e.preventDefault(),p=h.slider.getBoundingClientRect(),h.video.removeEventListener("timeupdate",r),"touchstart"===e.type&&(h.node.addEventListener("touchmove",u,!1),h.node.addEventListener("touchend",a,!1)),"mousedown"===e.type&&(document.addEventListener("mousemove",u,!1),document.addEventListener("mouseup",a,!1))}function a(e){e.stopPropagation(),e.preventDefault(),h.video.currentTime=f,h.video.addEventListener("timeupdate",r,!1),"touchend"===e.type&&(h.node.removeEventListener("touchmove",u),h.node.removeEventListener("touchend",a)),"mouseup"===e.type&&(document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",a))}function u(e){var t,i="touchmove"===e.type?e.touches[0]:e,n=i.pageX-p.left;e.preventDefault(),f=0>=n?0:n>=p.width?T:T*n/p.width,t=T-f,d(f,t)}function c(e){var t=h.video.currentTime;e.preventDefault(),h.video.currentTime=t>=y.skipTime?t-y.skipTime:0}function v(e){e.preventDefault(),h.video.currentTime<T-y.skipTime?h.video.currentTime+=y.skipTime:(h.video.pause(),h.video.currentTime=T)}function m(t){t.preventDefault(),e.$apply(function(){h.video.paused?h.video.play():h.video.pause(),e.STATES.isPlaying=!h.video.paused})}var f,p,S,T,h={},y={};h.controls=t[0],h.video=e.video,h.forwardButton=h.controls.querySelector(".fw30"),h.backButton=h.controls.querySelector(".back30"),h.slider=h.controls.querySelector(".slider"),h.node=h.controls.querySelector(".node"),h.playPause=h.controls.querySelector(".playPause"),h.timeIn=h.controls.querySelector(".timeIn"),h.timeLeft=h.controls.querySelector(".timeLeft"),y.skipTime=30,h.video.addEventListener("canplay",s,!1),h.video.addEventListener("timeupdate",r,!1),h.forwardButton.addEventListener("mousedown",v,!1),h.backButton.addEventListener("mousedown",c,!1),h.playPause.addEventListener("mousedown",m,!1),h.node.addEventListener("mousedown",l,!1),h.forwardButton.addEventListener("touchstart",v,!1),h.backButton.addEventListener("touchstart",c,!1),h.playPause.addEventListener("touchstart",m,!1),h.node.addEventListener("touchstart",l,!1),window.addEventListener("resize",o,!1)}}}angular.module("tb-video-player").directive("tbVideoControls",[e])}(),function(e){try{e=angular.module("tb-video-player.templates")}catch(t){e=angular.module("tb-video-player.templates",[])}e.run(["$templateCache",function(e){e.put("js/directives/templates/videoControls.html",'<div class="video-controls"><div class="controls"><div class="tb-vid_btn back30"></div><div class="tb-vid_btn playPause" ng-class="{ \'play\': !!STATES.isPlaying, \'pause\': !STATES.isPlaying }"></div><div class="tb-vid_btn fw30"></div><div class="progressIndicator"><div class="timeIn">{{ STATES.timeIn }}</div><div class="slider"><div class="node"></div></div><div class="timeLeft">{{ STATES.timeLeft }}</div></div></div></div>')}])}(),function(e){try{e=angular.module("tb-video-player.templates")}catch(t){e=angular.module("tb-video-player.templates",[])}e.run(["$templateCache",function(e){e.put("js/directives/templates/videoPlayer.html",'<div class="tb-video_container" ng-cloak=""><tb-video-slide ng-if="STATES.hasSlides"></tb-video-slide><tb-video-controls ng-if="STATES.hasControls"></tb-video-controls><video autoplay=""><source ng-src="{{ src | trustUrl }}" type="video/mp4"></video><img class="video-slide-clone" ng-src="{{ STATES.currentSlideImgSrc }}" ng-if="STATES.hasSlides"></div>')}])}(),function(e){try{e=angular.module("tb-video-player.templates")}catch(t){e=angular.module("tb-video-player.templates",[])}e.run(["$templateCache",function(e){e.put("js/directives/templates/videoSlides.html",'<div class="video-slide-thumb tb-slide-position"><img ng-src="{{ STATES.currentSlideImgSrc }}"></div>')}])}();
//# sourceMappingURL=tbVideoPlayer.min.js.map
