{"version":3,"sources":["tbVideoPlayer.min.js"],"names":["TbVideoPlayerCtrl","pad3","num","n","join","pad2","parseTime","t","round","minutes","Math","floor","seconds","ceil","browserTransform","i","el","document","createElement","browserPrefixes","style","whichTransitionEvent","transitions","transition","OTransition","MozTransition","WebkitTransition","undefined","ctrl","this","tbVideoPlayer","restrict","replace","scope","data","slides","src","videoEnd","controller","templateUrl","link","$scope","$element","$attrs","initVideo","video","addEventListener","checkIfSlidesHaveGoodStructure","slideIndex","length","hasOwnProperty","STATES","hasSlides","console","error","master","querySelector","hasControls","controls","angular","module","directive","filter","$sce","recordingUrl","trustAsResourceUrl","tbVideoSlide","require","calculateSlideVars","log","scaleVars","videoDimensions","bounds","DOM","getBoundingClientRect","slideDimensions","offsetLeft","slideContainer","offsetTop","fullSizeSlide","pictureChanged","needsResize","canBeReset","slideResizeHandler","e","thumbExpanded","removeExpandSlide","swapScalesImageWithFullSize","slideClone","top","left","width","height","classList","add","calculateScale","scaleX","scaleY","min","expandSlide","scale","xTransform","yTransform","preventDefault","remove","slideShow","changeSlideUrl","currentSlideImgSrc","fileLocation","resizeAlreadyExpandedClone","ct","currentTime","checkIndex","numberOfSlides","timeIndex","slideUrl","$apply","initSlide","slideImage","transitionEndEvent","window","tbVideoControls","tbVideoPlayerCtrl","resetElementMeasurements","sliderBounds","slider","nodeWidth","node","offsetWidth","initControls","duration","isPlaying","paused","updateTimeCounters","timeLeft","setTimeCounters","sliderPosition","timeIn","bindSliderNode","removeEventListener","type","sliderMove","unbindSliderNode","stopPropagation","tempVideoTime","event","touches","diff","pageX","back30","OPTIONS","skipTime","fw30","pause","playButtonHandler","play","forwardButton","backButton","playPause","run","$templateCache","put"],"mappings":"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","file":"tbVideoPlayer.min.js","sourcesContent":["(function(){\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player', ['tb-video-player.templates'])\r\n\t\t\t.controller('TbVideoPlayerCtrl', [TbVideoPlayerCtrl])\r\n\t\t\t.directive('tbVideoPlayer', [tbVideoPlayer])\r\n\t\t\t.filter(\"trustUrl\", ['$sce', function ($sce) {\r\n\t\t        return function (recordingUrl) {\r\n\t\t            return $sce.trustAsResourceUrl(recordingUrl);\r\n\t\t        };\r\n\t    \t}]);\r\n\r\n\tfunction TbVideoPlayerCtrl() {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tfunction pad3(num){\r\n\t\t\tvar n = (num < 10) ? ['00', num].join('') : (num < 100) ? ['0', num].join('') : num;\r\n\t\t\treturn n;\r\n\t\t}\r\n\r\n\t\tfunction pad2(num){\r\n\t\t\tvar n = (num < 10) ? ['0', num].join('') : num;\r\n\t\t\treturn n;\r\n\t\t}\r\n\r\n\t\tfunction parseTime(t, round){\r\n\t\t\tvar minutes = Math.floor(t/60),\r\n\t\t\t\tseconds = round != 'up' ? pad2(Math.floor(t%60)) : pad2(Math.ceil(t%60));\r\n\r\n\t\t\treturn [minutes, ':', seconds].join('');\r\n\t\t}\r\n\r\n\t\tfunction browserTransform() {\r\n\t\t\tvar el = document.createElement('fakeelement');\r\n\t\t\tvar browserPrefixes = ['OTransform', 'MozTransform', 'WebkitTransform'];\r\n\t\t\tvar i;\r\n\r\n\t\t\tfor (i in browserPrefixes) {\r\n\t\t\t\tif (typeof el.style[browserPrefixes[i]] !== 'undefined') {\r\n\t\t\t\t\treturn browserPrefixes[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn 'transform';\r\n\t\t}\r\n\r\n\t\t/* From Modernizr */\r\n\t\tfunction whichTransitionEvent(){\r\n\t\t    var t;\r\n\t\t    var el = document.createElement('fakeelement');\r\n\t\t    var transitions = {\r\n\t\t      'transition':'transitionend',\r\n\t\t      'OTransition':'oTransitionEnd',\r\n\t\t      'MozTransition':'transitionend',\r\n\t\t      'WebkitTransition':'webkitTransitionEnd'\r\n\t\t    };\r\n\r\n\t\t    for(t in transitions){\r\n\t\t        if( el.style[t] !== undefined ){\r\n\t\t            return transitions[t];\r\n\t\t        }\r\n\t\t    }\r\n\t\t}\r\n\r\n\t\tctrl.pad3 = pad3;\r\n\t\tctrl.pad2 = pad2;\r\n\t\tctrl.parseTime = parseTime;\r\n\t\tctrl.whichTransitionEvent = whichTransitionEvent;\r\n\t\tctrl.browserTransform = browserTransform;\r\n\t}\r\n\r\n\tfunction tbVideoPlayer() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\tscope: {\r\n\t\t\t\tdata: '=',\r\n\t\t\t\tslides: '=',\r\n\t\t\t\tsrc: '=',\r\n\t\t\t\tvideoEnd: '&'\r\n\t\t\t},\r\n\t\t\tcontroller: 'TbVideoPlayerCtrl',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoPlayer.html',\r\n\t\t\tlink: function($scope, $element, $attrs) {\r\n\t\t\t\t$scope.master = $element[0];\r\n\t\t\t\t$scope.video =  $scope.master.querySelector('video');\r\n\r\n\t\t\t\t$scope.STATES = {};\r\n\t\t\t\t$scope.STATES.hasControls = typeof $attrs.controls !== 'undefined';\r\n\t\t\t\t$scope.STATES.hasSlides = typeof $scope.slides !== 'undefined' && !!$scope.slides.length && checkIfSlidesHaveGoodStructure();\r\n\r\n\t\t\t\tfunction initVideo() {\r\n\t\t\t\t\tif (typeof $scope.videoEnd === 'function') {\r\n\t\t\t\t\t\t$scope.video.addEventListener('ended', $scope.videoEnd, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction checkIfSlidesHaveGoodStructure() {\r\n\t\t\t\t\tvar slideIndex = $scope.slides.length - 1;\r\n\r\n\t\t\t\t\twhile (slideIndex--) {\r\n\t\t\t\t\t\tif (!$scope.slides[slideIndex].hasOwnProperty('timeIndex')) {\r\n\t\t\t\t\t\t\t$scope.STATES.hasSlides = false;\r\n\t\t\t\t\t\t\tconsole.error('Object used in \"slides\" attribute is missing property: \"timeIndex\"');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$scope.slides[slideIndex].hasOwnProperty('slideUrl')) {\r\n\t\t\t\t\t\t\t$scope.STATES.hasSlides = false;\r\n\t\t\t\t\t\t\tconsole.error('Object used in \"slides\" attribute is missing property: \"slideUrl\"');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$scope.video.addEventListener('canplay', initVideo, false);\r\n\t\t\t}\r\n\t\t};\r\n\t}\t\t\t\r\n})();\n(function() {\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player')\r\n\t\t\t.directive('tbVideoSlide', [tbVideoSlide]);\r\n\r\n\tfunction tbVideoSlide() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\trequire: '^tbVideoPlayer',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoSlides.html',\r\n\t\t\tlink: function($scope, $element, $attrs, TbVideoPlayerCtrl) {\r\n\t\t\t\tvar DOM = {}; \r\n\t\t\t\tvar transitionEndEvent = TbVideoPlayerCtrl.whichTransitionEvent();\r\n\t\t\t\tvar browserTransform = TbVideoPlayerCtrl.browserTransform();\r\n\t\t\t\tvar thumbExpanded = false;\r\n\t\t\t\tvar numberOfSlides = $scope.slides.length; \r\n\t\t\t\tvar scaleVars;\r\n\r\n\t\t\t\tDOM.slideContainer = $element[0];\r\n\t\t\t\tDOM.master = $scope.master;\r\n\t\t\t\tDOM.video = $scope.video;\r\n\r\n\t\t\t\tfunction calculateSlideVars() {\r\n\t\t\t\t\tconsole.log('resetting slidevars');\r\n\t\t\t\t\tscaleVars = {\r\n\t\t\t\t\t\tvideoDimensions: { \r\n\t\t\t\t\t\t\tbounds: DOM.video.getBoundingClientRect() \r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tslideDimensions: { \r\n\t\t\t\t\t\t\tbounds: null,\r\n\t\t\t\t\t\t\toffsetLeft: DOM.slideContainer.offsetLeft,\r\n\t\t\t\t\t\t\toffsetTop: DOM.slideContainer.offsetTop\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfullSizeSlide: null,\r\n\t\t\t\t\t\tpictureChanged: false,\r\n\t\t\t\t\t\tneedsResize: false,\r\n\t\t\t\t\t\tcanBeReset: true\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction slideResizeHandler(e) {\r\n\t\t\t\t\tscaleVars.needsResize = true;\r\n\t\t\t\t\tif (!thumbExpanded) { \r\n\t\t\t\t\t\tcalculateSlideVars(); \r\n\t\t\t\t\t}\r\n\t\t\t\t\tremoveExpandSlide(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction swapScalesImageWithFullSize() {\r\n\t\t\t\t\tif (thumbExpanded) {\t\r\n\t\t\t\t\t\tscaleVars.canBeReset = false;\r\n\r\n\t\t\t\t\t\tif (scaleVars.fullSizeSlide === null) {\r\n\t\t\t\t\t\t\tscaleVars.fullSizeSlide = DOM.slideContainer.getBoundingClientRect();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tDOM.slideClone.style.top = scaleVars.fullSizeSlide.top - DOM.master.offsetTop + 'px';\r\n\t\t\t\t\t\tDOM.slideClone.style.left = scaleVars.fullSizeSlide.left - DOM.master.offsetLeft + 'px'; \r\n\t\t\t\t\t\tDOM.slideClone.style.width = scaleVars.fullSizeSlide.width + 'px'; \r\n\t\t\t\t\t\tDOM.slideClone.style.height = scaleVars.fullSizeSlide.height + 'px'; \r\n\t\t\t\t\t\tDOM.master.classList.add('slide-clone-visible');\r\n\t\t\t\t\t} else if (!!scaleVars.pictureChanged || !!scaleVars.needsResize) {\r\n\t\t\t\t\t\tscaleVars.canBeReset = true;\r\n\t\t\t\t\t\tcalculateSlideVars();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction calculateScale() {\r\n\t\t\t\t\tscaleVars.slideDimensions.bounds = DOM.slideContainer.getBoundingClientRect();\r\n\t\t\t\t\tvar scaleX = scaleVars.videoDimensions.bounds.width / scaleVars.slideDimensions.bounds.width;\r\n\t\t\t\t\tvar scaleY = scaleVars.videoDimensions.bounds.height / scaleVars.slideDimensions.bounds.height;\r\n\r\n\t\t\t\t\treturn Math.min(scaleX, scaleY);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction expandSlide(e) {\r\n\t\t\t\t\tscaleVars.scale = calculateScale();\r\n\t\t\t\t\tvar xTransform = -1*((scaleVars.slideDimensions.offsetLeft - (scaleVars.videoDimensions.bounds.width - scaleVars.slideDimensions.bounds.width*scaleVars.scale)/2)) + 'px';\r\n\t\t\t\t\tvar yTransform = -1*scaleVars.slideDimensions.offsetTop + 'px';\r\n\r\n\t\t\t\t\te.preventDefault();\t\t\r\n\r\n\t\t\t\t\tDOM.slideContainer.style[browserTransform] = 'translate(' + xTransform + ', ' + yTransform + ') scale(' + scaleVars.scale + ')';\r\n\r\n\t\t\t\t\tthumbExpanded = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction removeExpandSlide(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\tDOM.slideContainer.style[browserTransform] = null;\r\n\t\t\t\t\tDOM.master.classList.remove('slide-clone-visible');\r\n\r\n\t\t\t\t\tthumbExpanded = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction slideShow() {\r\n\t\t\t\t\tvar ct = Math.ceil(DOM.video.currentTime);\r\n\t\t\t\t\tvar checkIndex = numberOfSlides-1;\r\n\t\t\t\t\tvar fileLocation;\r\n\r\n\t\t\t\t\tfunction changeSlideUrl() {\r\n\t\t\t\t\t\t$scope.STATES.currentSlideImgSrc = fileLocation;\r\n\t\t\t\t\t\tscaleVars.pictureChanged = true;\r\n\t\t\t\t\t\tif (scaleVars.canBeReset = false) {\r\n\t\t\t\t\t\t\tresizeAlreadyExpandedClone();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// need to recheck sizes if picture changed\r\n\t\t\t\t\tif (scaleVars.pictureChanged === true && scaleVars.canBeReset === true ) {\r\n\t\t\t\t\t\tcalculateSlideVars();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (checkIndex--){\r\n\t\t\t\t\t\tif (ct >= $scope.slides[checkIndex].timeIndex && ct < $scope.slides[checkIndex+1].timeIndex ) {\r\n\t\t\t\t\t\t\t// found our index\r\n\r\n\t\t\t\t\t\t\tfileLocation = $scope.slides[checkIndex].slideUrl;\r\n\r\n\t\t\t\t\t\t\t// only change slide if slide needs changing\r\n\t\t\t\t\t\t\tif ($scope.STATES.currentSlideImgSrc !== fileLocation){\r\n\t\t\t\t\t\t\t\t$scope.$apply(changeSlideUrl);\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn;\t\t\r\n\t\t\t\t\t\t}\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction resizeAlreadyExpandedClone() {\r\n\t\t\t\t\tscaleVars.fullSizeSlide === null;\r\n\t\t\t\t\tswapScalesImageWithFullSize();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction initSlide() {\r\n\t\t\t\t\tcalculateSlideVars();\r\n\t\t\t\t\tDOM.slideImage = DOM.slideContainer.querySelector('img');\r\n\t\t\t\t\tDOM.slideClone = DOM.master.querySelector('.video-slide-clone');\r\n\r\n\t\t\t\t\tDOM.video.addEventListener('timeupdate', slideShow, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener('mousedown', expandSlide, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener('touchstart', expandSlide, false);\r\n\t\t\t\t\tDOM.slideClone.addEventListener('mousedown', removeExpandSlide, false);\r\n\t\t\t\t\tDOM.slideClone.addEventListener('touchstart', removeExpandSlide, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener(transitionEndEvent, swapScalesImageWithFullSize, false);\r\n\t\t\t\t\twindow.addEventListener('resize', slideResizeHandler, false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDOM.video.addEventListener('canplay', initSlide, false);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}());\n(function() {\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player')\r\n\t\t\t.directive('tbVideoControls', [tbVideoControls]);\r\n\r\n\tfunction tbVideoControls() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\trequire: '^tbVideoPlayer',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoControls.html',\r\n\t\t\tlink: function($scope, $element, $attrs, tbVideoPlayerCtrl) {\t\r\n\t\t\t\tvar DOM = {};\r\n\t\t\t\tvar OPTIONS = {};\r\n\t\t\t\tvar tempVideoTime;\r\n\t\t\t\tvar sliderBounds;\r\n\t\t\t\tvar nodeWidth;\r\n\t\t\t\tvar duration;\r\n\t\t\t\t\r\n\t\t\t\tDOM.controls = $element[0];\r\n\t\t\t\tDOM.video = $scope.video;\r\n\t\t\t\tDOM.forwardButton = DOM.controls.querySelector('.fw30');\r\n\t\t\t\tDOM.backButton = DOM.controls.querySelector('.back30');\r\n\t\t\t\tDOM.slider = DOM.controls.querySelector('.slider');\r\n\t\t\t\tDOM.node = DOM.controls.querySelector('.node');\r\n\t\t\t\tDOM.playPause = DOM.controls.querySelector('.playPause');\r\n\t\t\t\tDOM.timeIn = DOM.controls.querySelector('.timeIn');\r\n\t\t\t\tDOM.timeLeft = DOM.controls.querySelector('.timeLeft');\r\n\t\t\t\t\r\n\t\t\t\tfunction resetElementMeasurements() {\r\n\t\t\t\t\tsliderBounds = DOM.slider.getBoundingClientRect();\r\n\t\t\t\t\tnodeWidth = DOM.node.offsetWidth;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tOPTIONS.skipTime = 30;\r\n\r\n\t\t\t\tfunction initControls(e) {\r\n\t\t\t\t\tduration = DOM.video.duration;\r\n\t\t\t\t\t$scope.STATES.isPlaying = !DOM.video.paused;\t\r\n\t\t\t\t\tresetElementMeasurements();\r\n\t\t\t\t\tupdateTimeCounters();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction updateTimeCounters() {\r\n\t\t\t\t\tvar currentTime = DOM.video.currentTime;\r\n\t\t\t\t\tvar timeLeft = duration - currentTime;\r\n\r\n\t\t\t\t\tsetTimeCounters(currentTime, timeLeft);\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction setTimeCounters(currentTime, timeLeft) {\r\n\t\t\t\t\tvar sliderPosition = (currentTime * sliderBounds.width / duration) - nodeWidth/2;\r\n\r\n\t\t\t\t\tDOM.node.style.left = [sliderPosition, 'px'].join('');\r\n\r\n\t\t\t\t\t$scope.$apply(function() {\r\n\t\t\t\t\t\t$scope.STATES.timeIn = tbVideoPlayerCtrl.parseTime(currentTime, 'up');\r\n\t\t\t\t\t\t$scope.STATES.timeLeft = tbVideoPlayerCtrl.parseTime(timeLeft, 'down');\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction bindSliderNode(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tsliderBounds = DOM.slider.getBoundingClientRect();\r\n\r\n\t\t\t\t\t//stop updating time indices in the view\r\n\t\t\t\t\tDOM.video.removeEventListener('timeupdate', updateTimeCounters);\r\n\r\n\t\t\t\t\t// bind slider behaviour\r\n\r\n\t\t\t\t\tif (e.type === 'touchstart') {\r\n\t\t\t\t\t\tDOM.node.addEventListener('touchmove', sliderMove, false);\r\n\t\t\t\t\t\tDOM.node.addEventListener('touchend', unbindSliderNode, false);\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tif (e.type === 'mousedown') {\r\n\t\t\t\t\t\tdocument.addEventListener('mousemove', sliderMove, false);\r\n\t\t\t\t\t\tdocument.addEventListener('mouseup', unbindSliderNode, false);\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction unbindSliderNode(e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tDOM.video.currentTime = tempVideoTime;\r\n\r\n\t\t\t\t\t//restart updating time indices in the view\r\n\t\t\t\t\tDOM.video.addEventListener('timeupdate', updateTimeCounters, false);\r\n\r\n\t\t\t\t\t// remove slider behaviour\r\n\t\t\t\t\tif (e.type === 'touchend') {\r\n\t\t\t\t\t\tDOM.node.removeEventListener('touchmove', sliderMove);\r\n\t\t\t\t\t\tDOM.node.removeEventListener('touchend', unbindSliderNode);\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tif (e.type === 'mouseup') {\r\n\t\t\t\t\t\tdocument.removeEventListener('mousemove', sliderMove);\r\n\t\t\t\t\t\tdocument.removeEventListener('mouseup', unbindSliderNode);\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\tfunction sliderMove (e) {\r\n\t\t\t\t\tvar event = e.type === 'touchmove' ? e.touches[0] : e;\r\n\t\t\t\t\tvar diff = event.pageX - sliderBounds.left;\r\n\t\t\t\t\tvar timeLeft;\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tif (diff <= 0) { //too left\r\n\t\t\t\t\t\ttempVideoTime = 0;\r\n\t\t\t\t\t} else if (diff >= sliderBounds.width) { // too right\r\n\t\t\t\t\t\ttempVideoTime = duration;\r\n\t\t\t\t\t} else { // ok\r\n\t\t\t\t\t\ttempVideoTime = (duration * diff) / sliderBounds.width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttimeLeft = duration - tempVideoTime;\r\n\r\n\t\t\t\t\tsetTimeCounters(tempVideoTime, timeLeft);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction back30(e){\r\n\t\t\t\t\tvar currentTime = DOM.video.currentTime;\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tDOM.video.currentTime = currentTime >= OPTIONS.skipTime ? (currentTime - OPTIONS.skipTime) : 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction fw30(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tif (DOM.video.currentTime < (duration - OPTIONS.skipTime)){\r\n\t\t\t\t\t\tDOM.video.currentTime += OPTIONS.skipTime;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tDOM.video.pause();\r\n\t\t\t\t\t\tDOM.video.currentTime = duration;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction playButtonHandler (e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t$scope.$apply(function() {\r\n\t\t\t\t\t\tif (!DOM.video.paused){\r\n\t\t\t\t\t\t\tDOM.video.pause();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tDOM.video.play();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$scope.STATES.isPlaying = !DOM.video.paused;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\tDOM.video.addEventListener('canplay', initControls, false);\r\n\t\t\t\tDOM.video.addEventListener('timeupdate', updateTimeCounters, false);\r\n\r\n\t\t\t\tDOM.forwardButton.addEventListener('mousedown', fw30, false);\r\n\t\t\t\tDOM.backButton.addEventListener('mousedown', back30, false);\r\n\t\t\t\tDOM.playPause.addEventListener('mousedown', playButtonHandler, false);\r\n\t\t\t\tDOM.node.addEventListener('mousedown', bindSliderNode, false);\r\n\r\n\t\t\t\tDOM.forwardButton.addEventListener('touchstart', fw30, false);\r\n\t\t\t\tDOM.backButton.addEventListener('touchstart', back30, false);\r\n\t\t\t\tDOM.playPause.addEventListener('touchstart', playButtonHandler, false);\r\n\t\t\t\tDOM.node.addEventListener('touchstart', bindSliderNode, false);\r\n\r\n\t\t\t\twindow.addEventListener('resize', resetElementMeasurements, false)\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}());\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoControls.html',\n    '<div class=\"video-controls\"><div class=\"controls\"><div class=\"tb-vid_btn back30\"></div><div class=\"tb-vid_btn playPause\" ng-class=\"{ \\'play\\': !!STATES.isPlaying, \\'pause\\': !STATES.isPlaying }\"></div><div class=\"tb-vid_btn fw30\"></div><div class=\"progressIndicator\"><div class=\"timeIn\">{{ STATES.timeIn }}</div><div class=\"slider\"><div class=\"node\"></div></div><div class=\"timeLeft\">{{ STATES.timeLeft }}</div></div></div></div>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoPlayer.html',\n    '<div class=\"tb-video_container\" ng-cloak=\"\"><tb-video-slide ng-if=\"STATES.hasSlides\"></tb-video-slide><tb-video-controls ng-if=\"STATES.hasControls\"></tb-video-controls><video autoplay=\"\"><source ng-src=\"{{ src | trustUrl }}\" type=\"video/mp4\"></video><img class=\"video-slide-clone\" ng-src=\"{{ STATES.currentSlideImgSrc }}\" ng-if=\"STATES.hasSlides\"></div>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoSlides.html',\n    '<div class=\"video-slide-thumb tb-slide-position\"><img ng-src=\"{{ STATES.currentSlideImgSrc }}\"></div>');\n}]);\n})();\n"],"sourceRoot":"/source/"}