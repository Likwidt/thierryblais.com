{"version":3,"sources":["tbVideoPlayer.min.js"],"names":["TbVideoPlayerCtrl","pad3","num","n","join","pad2","parseTime","t","round","minutes","Math","floor","seconds","ceil","browserTransform","i","el","document","createElement","browserPrefixes","style","whichTransitionEvent","transitions","transition","OTransition","MozTransition","WebkitTransition","undefined","ctrl","this","tbVideoPlayer","restrict","replace","scope","data","slides","src","videoEnd","controller","templateUrl","link","$scope","$element","$attrs","initVideo","video","addEventListener","checkIfSlidesHaveGoodStructure","slideIndex","length","hasOwnProperty","STATES","hasSlides","console","error","master","querySelector","hasControls","controls","angular","module","directive","filter","$sce","recordingUrl","trustAsResourceUrl","tbVideoSlide","require","calculateScaleVars","scaleVars","videoDimensions","bounds","DOM","getBoundingClientRect","slideDimensions","slideContainer","offsetLeft","offsetTop","fullSizeSlide","scale","pictureChanged","needsResize","slideResizeHandler","e","thumbExpanded","removeExpandSlide","swapScalesImageWithFullSize","slideClone","top","left","width","height","classList","add","calculateScale","scaleX","scaleY","min","expandSlide","xTransform","yTransform","preventDefault","remove","slideShow","changeSlideUrl","currentSlideImgSrc","fileLocation","ct","currentTime","checkIndex","numberOfSlides","timeIndex","slideUrl","$apply","initSlide","slideImage","transitionEndEvent","window","tbVideoControls","tbVideoPlayerCtrl","initControls","duration","sliderBounds","slider","isPlaying","paused","nodeWidth","node","offsetWidth","updateTimeCounters","timeLeft","setTimeCounters","sliderPosition","timeIn","bindSliderNode","removeEventListener","type","sliderMove","unbindSliderNode","stopPropagation","tempVideoTime","event","touches","diff","pageX","back30","OPTIONS","skipTime","fw30","pause","playButtonHandler","play","forwardButton","backButton","playPause","run","$templateCache","put"],"mappings":"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","file":"tbVideoPlayer.min.js","sourcesContent":["(function(){\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player', ['tb-video-player.templates'])\r\n\t\t\t.controller('TbVideoPlayerCtrl', [TbVideoPlayerCtrl])\r\n\t\t\t.directive('tbVideoPlayer', [tbVideoPlayer])\r\n\t\t\t.filter(\"trustUrl\", ['$sce', function ($sce) {\r\n\t\t        return function (recordingUrl) {\r\n\t\t            return $sce.trustAsResourceUrl(recordingUrl);\r\n\t\t        };\r\n\t    \t}]);\r\n\r\n\tfunction TbVideoPlayerCtrl() {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tfunction pad3(num){\r\n\t\t\tvar n = (num < 10) ? ['00', num].join('') : (num < 100) ? ['0', num].join('') : num;\r\n\t\t\treturn n;\r\n\t\t}\r\n\r\n\t\tfunction pad2(num){\r\n\t\t\tvar n = (num < 10) ? ['0', num].join('') : num;\r\n\t\t\treturn n;\r\n\t\t}\r\n\r\n\t\tfunction parseTime(t, round){\r\n\t\t\tvar minutes = Math.floor(t/60),\r\n\t\t\t\tseconds = round != 'up' ? pad2(Math.floor(t%60)) : pad2(Math.ceil(t%60));\r\n\r\n\t\t\treturn [minutes, ':', seconds].join('');\r\n\t\t}\r\n\r\n\t\tfunction browserTransform() {\r\n\t\t\tvar el = document.createElement('fakeelement');\r\n\t\t\tvar browserPrefixes = ['OTransform', 'MozTransform', 'WebkitTransform'];\r\n\t\t\tvar i;\r\n\r\n\t\t\tfor (i in browserPrefixes) {\r\n\t\t\t\tif (typeof el.style[browserPrefixes[i]] !== 'undefined') {\r\n\t\t\t\t\treturn browserPrefixes[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn 'transform';\r\n\t\t}\r\n\r\n\t\t/* From Modernizr */\r\n\t\tfunction whichTransitionEvent(){\r\n\t\t    var t;\r\n\t\t    var el = document.createElement('fakeelement');\r\n\t\t    var transitions = {\r\n\t\t      'transition':'transitionend',\r\n\t\t      'OTransition':'oTransitionEnd',\r\n\t\t      'MozTransition':'transitionend',\r\n\t\t      'WebkitTransition':'webkitTransitionEnd'\r\n\t\t    };\r\n\r\n\t\t    for(t in transitions){\r\n\t\t        if( el.style[t] !== undefined ){\r\n\t\t            return transitions[t];\r\n\t\t        }\r\n\t\t    }\r\n\t\t}\r\n\r\n\t\tctrl.pad3 = pad3;\r\n\t\tctrl.pad2 = pad2;\r\n\t\tctrl.parseTime = parseTime;\r\n\t\tctrl.whichTransitionEvent = whichTransitionEvent;\r\n\t\tctrl.browserTransform = browserTransform;\r\n\t}\r\n\r\n\tfunction tbVideoPlayer() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\tscope: {\r\n\t\t\t\tdata: '=',\r\n\t\t\t\tslides: '=',\r\n\t\t\t\tsrc: '=',\r\n\t\t\t\tvideoEnd: '&'\r\n\t\t\t},\r\n\t\t\tcontroller: 'TbVideoPlayerCtrl',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoPlayer.html',\r\n\t\t\tlink: function($scope, $element, $attrs) {\r\n\t\t\t\t$scope.master = $element[0];\r\n\t\t\t\t$scope.video =  $scope.master.querySelector('video');\r\n\r\n\t\t\t\t$scope.STATES = {};\r\n\t\t\t\t$scope.STATES.hasControls = typeof $attrs.controls !== 'undefined';\r\n\t\t\t\t$scope.STATES.hasSlides = typeof $scope.slides !== 'undefined' && !!$scope.slides.length && checkIfSlidesHaveGoodStructure();\r\n\r\n\t\t\t\tfunction initVideo() {\r\n\t\t\t\t\tif (typeof $scope.videoEnd === 'function') {\r\n\t\t\t\t\t\t$scope.video.addEventListener('ended', $scope.videoEnd, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction checkIfSlidesHaveGoodStructure() {\r\n\t\t\t\t\tvar slideIndex = $scope.slides.length - 1;\r\n\r\n\t\t\t\t\twhile (slideIndex--) {\r\n\t\t\t\t\t\tif (!$scope.slides[slideIndex].hasOwnProperty('timeIndex')) {\r\n\t\t\t\t\t\t\t$scope.STATES.hasSlides = false;\r\n\t\t\t\t\t\t\tconsole.error('Object used in \"slides\" attribute is missing property: \"timeIndex\"');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$scope.slides[slideIndex].hasOwnProperty('slideUrl')) {\r\n\t\t\t\t\t\t\t$scope.STATES.hasSlides = false;\r\n\t\t\t\t\t\t\tconsole.error('Object used in \"slides\" attribute is missing property: \"slideUrl\"');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$scope.video.addEventListener('canplay', initVideo, false);\r\n\t\t\t}\r\n\t\t};\r\n\t}\t\t\t\r\n})();\n(function() {\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player')\r\n\t\t\t.directive('tbVideoSlide', [tbVideoSlide]);\r\n\r\n\tfunction tbVideoSlide() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\trequire: '^tbVideoPlayer',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoSlides.html',\r\n\t\t\tlink: function($scope, $element, $attrs, TbVideoPlayerCtrl) {\r\n\t\t\t\tvar DOM = {}; \r\n\t\t\t\tvar transitionEndEvent = TbVideoPlayerCtrl.whichTransitionEvent();\r\n\t\t\t\tvar browserTransform = TbVideoPlayerCtrl.browserTransform();\r\n\t\t\t\tvar thumbExpanded = false;\r\n\t\t\t\tvar numberOfSlides = $scope.slides.length; \r\n\t\t\t\tvar scaleVars;\r\n\r\n\t\t\t\tDOM.slideContainer = $element[0];\r\n\t\t\t\tDOM.master = $scope.master;\r\n\t\t\t\tDOM.video = $scope.video;\r\n\r\n\t\t\t\tfunction calculateScaleVars() {\r\n\t\t\t\t\tscaleVars = {\r\n\t\t\t\t\t\tvideoDimensions: { \r\n\t\t\t\t\t\t\tbounds: DOM.video.getBoundingClientRect() \r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tslideDimensions: { \r\n\t\t\t\t\t\t\tbounds: DOM.slideContainer.getBoundingClientRect(),\r\n\t\t\t\t\t\t\toffsetLeft: DOM.slideContainer.offsetLeft,\r\n\t\t\t\t\t\t\toffsetTop: DOM.slideContainer.offsetTop\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfullSizeSlide: null,\r\n\t\t\t\t\t\tscale: null,\r\n\t\t\t\t\t\tpictureChanged: false,\r\n\t\t\t\t\t\tneedsResize: false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction slideResizeHandler(e) {\r\n\t\t\t\t\tscaleVars.needsResize = true;\r\n\t\t\t\t\tif (!thumbExpanded) { \r\n\t\t\t\t\t\tcalculateScaleVars(); \r\n\t\t\t\t\t}\r\n\t\t\t\t\tremoveExpandSlide(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction swapScalesImageWithFullSize() {\r\n\t\t\t\t\tif (thumbExpanded) {\t\r\n\t\t\t\t\t\tif (scaleVars.fullSizeSlide === null) {\r\n\t\t\t\t\t\t\tscaleVars.fullSizeSlide = DOM.slideContainer.getBoundingClientRect();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tDOM.slideClone.style.top = scaleVars.fullSizeSlide.top - DOM.master.offsetTop + 'px';\r\n\t\t\t\t\t\tDOM.slideClone.style.left = scaleVars.fullSizeSlide.left - DOM.master.offsetLeft + 'px'; \r\n\t\t\t\t\t\tDOM.slideClone.style.width = scaleVars.fullSizeSlide.width + 'px'; \r\n\t\t\t\t\t\tDOM.slideClone.style.height = scaleVars.fullSizeSlide.height + 'px'; \r\n\t\t\t\t\t\tDOM.slideClone.classList.add('visible');\r\n\t\t\t\t\t} else if (scaleVars.needsResize === true) {\r\n\t\t\t\t\t\tcalculateScaleVars();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction calculateScale() {\r\n\t\t\t\t\tvar scaleX = scaleVars.videoDimensions.bounds.width / scaleVars.slideDimensions.bounds.width;\r\n\t\t\t\t\tvar scaleY = scaleVars.videoDimensions.bounds.height / scaleVars.slideDimensions.bounds.height;\r\n\r\n\t\t\t\t\treturn Math.min(scaleX, scaleY);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction expandSlide(e) {\r\n\t\t\t\t\tif (scaleVars.scale === null) {\r\n\t\t\t\t\t\tscaleVars.scale = calculateScale();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar xTransform = -1*((scaleVars.slideDimensions.offsetLeft - (scaleVars.videoDimensions.bounds.width - scaleVars.slideDimensions.bounds.width*scaleVars.scale)/2)) + 'px';\r\n\t\t\t\t\tvar yTransform = -1*scaleVars.slideDimensions.offsetTop + 'px';\r\n\r\n\t\t\t\t\te.preventDefault();\t\t\r\n\r\n\t\t\t\t\tDOM.slideContainer.style[browserTransform] = 'translate(' + xTransform + ', ' + yTransform + ') scale(' + scaleVars.scale + ')';\r\n\r\n\t\t\t\t\tthumbExpanded = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction removeExpandSlide(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tDOM.slideContainer.style[browserTransform] = null;\r\n\t\t\t\t\tDOM.slideClone.classList.remove('visible');\r\n\r\n\t\t\t\t\tthumbExpanded = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction slideShow() {\r\n\t\t\t\t\tvar ct = Math.ceil(DOM.video.currentTime);\r\n\t\t\t\t\tvar checkIndex = numberOfSlides-1;\r\n\t\t\t\t\tvar fileLocation;\r\n\r\n\t\t\t\t\tfunction changeSlideUrl() {\r\n\t\t\t\t\t\t$scope.STATES.currentSlideImgSrc = fileLocation;\r\n\t\t\t\t\t\tscaleVars.pictureChanged = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// need to recheck sizes if picture changed\r\n\t\t\t\t\tif (scaleVars.pictureChanged === true && thumbExpanded === false) {\r\n\t\t\t\t\t\tcalculateScaleVars();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (checkIndex--){\r\n\t\t\t\t\t\tif (ct >= $scope.slides[checkIndex].timeIndex && ct < $scope.slides[checkIndex+1].timeIndex ) {\r\n\t\t\t\t\t\t\t// found our index\r\n\r\n\t\t\t\t\t\t\tfileLocation = $scope.slides[checkIndex].slideUrl;\r\n\r\n\t\t\t\t\t\t\t// only change slide if slide needs changing\r\n\t\t\t\t\t\t\tif ($scope.STATES.currentSlideImgSrc !== fileLocation){\r\n\t\t\t\t\t\t\t\t$scope.$apply(changeSlideUrl);\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn;\t\t\r\n\t\t\t\t\t\t}\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction initSlide() {\r\n\t\t\t\t\tcalculateScaleVars();\r\n\t\t\t\t\tDOM.slideImage = DOM.slideContainer.querySelector('img');\r\n\t\t\t\t\tDOM.slideClone = DOM.master.querySelector('.video-slide-clone');\r\n\r\n\t\t\t\t\tDOM.video.addEventListener('timeupdate', slideShow, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener('mousedown', expandSlide, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener('touchstart', expandSlide, false);\r\n\t\t\t\t\tDOM.slideClone.addEventListener('mousedown', removeExpandSlide, false);\r\n\t\t\t\t\tDOM.slideClone.addEventListener('touchstart', removeExpandSlide, false);\r\n\t\t\t\t\tDOM.slideContainer.addEventListener(transitionEndEvent, swapScalesImageWithFullSize, false);\r\n\t\t\t\t\twindow.addEventListener('resize', slideResizeHandler, false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDOM.video.addEventListener('canplay', initSlide, false);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}());\n(function() {\r\n\t\"use strict\";\r\n\r\n\tangular .module('tb-video-player')\r\n\t\t\t.directive('tbVideoControls', [tbVideoControls]);\r\n\r\n\tfunction tbVideoControls() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\treplace: true,\r\n\t\t\trequire: '^tbVideoPlayer',\r\n\t\t\ttemplateUrl: 'js/directives/templates/videoControls.html',\r\n\t\t\tlink: function($scope, $element, $attrs, tbVideoPlayerCtrl) {\t\r\n\t\t\t\tvar DOM = {};\r\n\t\t\t\tvar OPTIONS = {};\r\n\t\t\t\tvar tempVideoTime;\r\n\t\t\t\tvar sliderBounds;\r\n\t\t\t\tvar nodeWidth;\r\n\t\t\t\tvar duration;\r\n\t\t\t\t\r\n\t\t\t\tDOM.controls = $element[0];\r\n\t\t\t\tDOM.video = $scope.video;\r\n\t\t\t\tDOM.forwardButton = DOM.controls.querySelector('.fw30');\r\n\t\t\t\tDOM.backButton = DOM.controls.querySelector('.back30');\r\n\t\t\t\tDOM.slider = DOM.controls.querySelector('.slider');\r\n\t\t\t\tDOM.node = DOM.controls.querySelector('.node');\r\n\t\t\t\tDOM.playPause = DOM.controls.querySelector('.playPause');\r\n\t\t\t\tDOM.timeIn = DOM.controls.querySelector('.timeIn');\r\n\t\t\t\tDOM.timeLeft = DOM.controls.querySelector('.timeLeft');\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tOPTIONS.skipTime = 30;\r\n\r\n\t\t\t\tfunction initControls(e) {\r\n\t\t\t\t\tduration = DOM.video.duration;\r\n\t\t\t\t\tsliderBounds = DOM.slider.getBoundingClientRect();\r\n\t\t\t\t\t$scope.STATES.isPlaying = !DOM.video.paused;\t\r\n\t\t\t\t\tnodeWidth = DOM.node.offsetWidth;\r\n\r\n\t\t\t\t\tupdateTimeCounters();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction updateTimeCounters() {\r\n\t\t\t\t\tvar currentTime = DOM.video.currentTime;\r\n\t\t\t\t\tvar timeLeft = duration - currentTime;\r\n\r\n\t\t\t\t\tsetTimeCounters(currentTime, timeLeft);\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction setTimeCounters(currentTime, timeLeft) {\r\n\t\t\t\t\tvar sliderPosition = (currentTime * sliderBounds.width / duration) - nodeWidth/2;\r\n\r\n\t\t\t\t\tDOM.node.style.left = [sliderPosition, 'px'].join('');\r\n\r\n\t\t\t\t\t$scope.$apply(function() {\r\n\t\t\t\t\t\t$scope.STATES.timeIn = tbVideoPlayerCtrl.parseTime(currentTime, 'up');\r\n\t\t\t\t\t\t$scope.STATES.timeLeft = tbVideoPlayerCtrl.parseTime(timeLeft, 'down');\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction bindSliderNode(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tsliderBounds = DOM.slider.getBoundingClientRect();\r\n\r\n\t\t\t\t\t//stop updating time indices in the view\r\n\t\t\t\t\tDOM.video.removeEventListener('timeupdate', updateTimeCounters);\r\n\r\n\t\t\t\t\t// bind slider behaviour\r\n\r\n\t\t\t\t\tif (e.type === 'touchstart') {\r\n\t\t\t\t\t\tDOM.node.addEventListener('touchmove', sliderMove, false);\r\n\t\t\t\t\t\tDOM.node.addEventListener('touchend', unbindSliderNode, false);\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tif (e.type === 'mousedown') {\r\n\t\t\t\t\t\tdocument.addEventListener('mousemove', sliderMove, false);\r\n\t\t\t\t\t\tdocument.addEventListener('mouseup', unbindSliderNode, false);\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction unbindSliderNode(e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tDOM.video.currentTime = tempVideoTime;\r\n\r\n\t\t\t\t\t//restart updating time indices in the view\r\n\t\t\t\t\tDOM.video.addEventListener('timeupdate', updateTimeCounters, false);\r\n\r\n\t\t\t\t\t// remove slider behaviour\r\n\t\t\t\t\tif (e.type === 'touchend') {\r\n\t\t\t\t\t\tDOM.node.removeEventListener('touchmove', sliderMove);\r\n\t\t\t\t\t\tDOM.node.removeEventListener('touchend', unbindSliderNode);\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tif (e.type === 'mouseup') {\r\n\t\t\t\t\t\tdocument.removeEventListener('mousemove', sliderMove);\r\n\t\t\t\t\t\tdocument.removeEventListener('mouseup', unbindSliderNode);\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\tfunction sliderMove (e) {\r\n\t\t\t\t\tvar event = e.type === 'touchmove' ? e.touches[0] : e;\r\n\t\t\t\t\tvar diff = event.pageX - sliderBounds.left;\r\n\t\t\t\t\tvar timeLeft;\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tif (diff <= 0) { //too left\r\n\t\t\t\t\t\ttempVideoTime = 0;\r\n\t\t\t\t\t} else if (diff >= sliderBounds.width) { // too right\r\n\t\t\t\t\t\ttempVideoTime = duration;\r\n\t\t\t\t\t} else { // ok\r\n\t\t\t\t\t\ttempVideoTime = (duration * diff) / sliderBounds.width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttimeLeft = duration - tempVideoTime;\r\n\r\n\t\t\t\t\tsetTimeCounters(tempVideoTime, timeLeft);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction back30(e){\r\n\t\t\t\t\tvar currentTime = DOM.video.currentTime;\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tDOM.video.currentTime = currentTime >= OPTIONS.skipTime ? (currentTime - OPTIONS.skipTime) : 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction fw30(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tif (DOM.video.currentTime < (duration - OPTIONS.skipTime)){\r\n\t\t\t\t\t\tDOM.video.currentTime += OPTIONS.skipTime;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tDOM.video.pause();\r\n\t\t\t\t\t\tDOM.video.currentTime = duration;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction playButtonHandler (e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t$scope.$apply(function() {\r\n\t\t\t\t\t\tif (!DOM.video.paused){\r\n\t\t\t\t\t\t\tDOM.video.pause();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tDOM.video.play();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$scope.STATES.isPlaying = !DOM.video.paused;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDOM.video.addEventListener('canplay', initControls, false);\r\n\t\t\t\tDOM.video.addEventListener('timeupdate', updateTimeCounters, false);\r\n\r\n\t\t\t\tDOM.forwardButton.addEventListener('mousedown', fw30, false);\r\n\t\t\t\tDOM.backButton.addEventListener('mousedown', back30, false);\r\n\t\t\t\tDOM.playPause.addEventListener('mousedown', playButtonHandler, false);\r\n\t\t\t\tDOM.node.addEventListener('mousedown', bindSliderNode, false);\r\n\r\n\t\t\t\tDOM.forwardButton.addEventListener('touchstart', fw30, false);\r\n\t\t\t\tDOM.backButton.addEventListener('touchstart', back30, false);\r\n\t\t\t\tDOM.playPause.addEventListener('touchstart', playButtonHandler, false);\r\n\t\t\t\tDOM.node.addEventListener('touchstart', bindSliderNode, false);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}());\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoControls.html',\n    '<div class=\"video-controls\"><div class=\"controls\"><div class=\"tb-vid_btn back30\"></div><div class=\"tb-vid_btn playPause\" ng-class=\"{ \\'play\\': !!STATES.isPlaying, \\'pause\\': !STATES.isPlaying }\"></div><div class=\"tb-vid_btn fw30\"></div><div class=\"progressIndicator\"><div class=\"timeIn\">{{ STATES.timeIn }}</div><div class=\"slider\"><div class=\"node\"></div></div><div class=\"timeLeft\">{{ STATES.timeLeft }}</div></div></div></div>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoPlayer.html',\n    '<div class=\"tb-video_container\" ng-cloak=\"\"><tb-video-slide ng-if=\"STATES.hasSlides\"></tb-video-slide><tb-video-controls ng-if=\"STATES.hasControls\"></tb-video-controls><video autoplay=\"\"><source ng-src=\"{{ src | trustUrl }}\" type=\"video/mp4\"></video><img class=\"video-slide-clone\" ng-src=\"{{ STATES.currentSlideImgSrc }}\" ng-if=\"STATES.hasSlides\"></div>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('tb-video-player.templates');\n} catch (e) {\n  module = angular.module('tb-video-player.templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('js/directives/templates/videoSlides.html',\n    '<div class=\"video-slide-thumb tb-slide-position\"><img ng-src=\"{{ STATES.currentSlideImgSrc }}\"></div>');\n}]);\n})();\n"],"sourceRoot":"/source/"}