!function(){"use strict";angular.module("tb-free-draw",[]).directive("tbFreeDraw",["$timeout",function(e){return{restrict:"A",scope:{drawTo:"="},link:function(t,n){function o(){function n(e){e.preventDefault()}function o(e){var t=e.changedTouches?e.changedTouches[0]:e,n=i.getBoundingClientRect();d.lineTo(t.clientX-n.left,t.clientY-n.top),d.stroke()}function r(){i.removeEventListener("touchmove",o),i.removeEventListener("touchend",r),i.removeEventListener("touchleave",r),i.removeEventListener("mousemove",o),i.removeEventListener("mouseup",r),i.removeEventListener("mouseout",r),window.removeEventListener("touchmove",n),a(i.toDataURL("image/png"))}function u(e){var t=e.changedTouches?e.changedTouches[0]:e;d.moveTo(t.pageX,t.pageY),d.beginPath(),i.addEventListener("touchmove",o,!1),i.addEventListener("touchend",r,!1),i.addEventListener("touchleave",r,!1),i.addEventListener("mousemove",o,!1),i.addEventListener("mouseup",r,!1),i.addEventListener("mouseout",r,!1),window.addEventListener("touchmove",n,!1)}function a(e){t.$apply(function(){t.drawTo=e})}function c(){var t=i.getBoundingClientRect(),n=i.getContext("2d");n.clearRect(0,0,t.width,t.height),e(function(){a(i.toDataURL("image/png"))},0)}var d=i.getContext("2d");t.$on("tb.freedraw.clear",c),i.addEventListener("touchstart",u,!1),i.addEventListener("mousedown",u,!1)}var i=n[0];"CANVAS"===i.nodeName&&o()}}}])}();